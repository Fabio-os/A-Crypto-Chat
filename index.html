<!doctype html>
<html>
    <head>
        <title>A-Crypto-Chat</title>
        <style>
            :root {
                --main-color: #272346;
                --dark-color: #0c002b;
                --bubble-color: #8400ff;
                --personal-bubble-color: #cecece;
                --light-color: #ddd;
            }
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font: 13px Helvetica, Arial;
            }
            form {
                background: white;;
                padding: 3px;
                position: fixed;
                bottom: 0;
                width: 100%;
                height: 100%;
            }
            form input {
                background: white;
                border: 0;
                border-radius: 50px;
                outline: none;
                padding: 20px;
                width: calc(100% - 20px);
                height: 40px;
                color: black;
                margin-left: 10px;
                transition: all 0.3s ease;
                box-shadow: 0px -10px 50px rgba(0, 0, 0, 0.3);
            }
            form input:focus, input:focus + button {
                transform: translateY(-5px);
            }
            form button {
                position: relative;
                top: -40px;
                left: calc(100% - 110px);
                user-select: none;
                text-transform: uppercase;
                width: 100px;
                height: 40px;
                color: white;
                font-size: 16px;
                outline: none;
                border-radius: 30px;
                border: none;
                background: black;
                transition: all 0.3s ease;
                box-shadow: 0 0px 50px rgba(0, 0, 0, 0.3);
            }
            form button:hover {
                color: black;
                background: white;
                box-shadow: 0 0px 50px rgba(0, 0, 0, 0.5);
            }
            #messages {
                list-style-type: none;
                margin: 0;
                padding: 0;
                height: calc(100% - 145px);
                overflow-y: scroll;
                margin-top: 20px;
                margin-bottom: 20px;
                position: relative;
                z-index: -1;
            }
            #username {
                width: 250px;
                margin-top: 10px;
                box-shadow: 0px 10px 50px rgba(0, 0, 0, 0.3);
            }
            #username:focus {
                transform: translateY(5px);
            }
            .container {
                margin-bottom: 40px;
                width: 100%;
            }
            .bubble {
                display: flex;
                justify-content: flex-start;
            }
            .header {
                display: flex;
                margin-bottom: 5px;
                font-style: italic;
                font-size: 0px;
                white-space: pre;
                color: grey;
            }
            .message {
                position: relative;
                z-index: 999;
                background: black;
                border-radius: 20px;
                box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.3);
                padding: 10px 15px;
                display: inline-block;
                color: white;
                max-width: 40%;
                transition: all 0.3s ease;
            }
            .message:hover {
                transform: translateY(3px);
            }
            .message::selection {
                background: white;
                color: black;
            }
            .message::-moz-selection {
                background: white;
                color: black;
            }
            .myself {
                margin-right: 15px;
            }
            .other {
                margin-left: 15px;
            }
            .header.other {
                font-size: 12px;
            }
            .message.other {
                background: white;
                color: black;
            }
            .message.other::selection {
                background: black;
                color: white;
            }
            .message.other::-moz-selection {
                background: black;
                color: white;
            }
            .scroll::-webkit-scrollbar {
                width: 10px;
            }
            .scroll::-webkit-scrollbar-thumb {
                background: white;
                border-radius: 10px;
            }
            .scroll::-webkit-scrollbar-track {
                background: grey;
                border-radius: 10px;
                box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.5);
            }
        </style>
        <link rel="icon" type="image/pgn" href="https://user-images.githubusercontent.com/2795476/51910277-b7e42a80-2409-11e9-98aa-522020814a31.png"/>
    </head>
    <body>
        <form id="form" action="">
            <input autocomplete="off" id="username" maxlength="15" placeholder="Username" required/>
            <ul id="messages" class="scroll"></ul>
            <input id="message" autocomplete="off" placeholder="Message" required/><button>Send</button>
        </form>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
        <script>
            const socket = io();
            const id = '_' + Math.random().toString(36).substr(2, 9);
            async function onFormSubmit(event) {
                event.preventDefault();
                let message = {};
                message.owner = document.getElementById("username").value;
                message.value = document.getElementById("message").value;
                message.id = id;
                socket.emit("chat message", message);
                document.getElementById("message").value = "";
                return false;
            }
            document.getElementById("form").addEventListener("submit", onFormSubmit);
            socket.on("chat message", (msg) => {
                let lastOwner = "";
                const days = { 1: "Monday", 2: "Tuesday", 3: "Wednesday", 4: "Thursday", 5: "Friday", 6: "Saturday", 7: "Synday" };
                const realDate = new Date();
                if (document.getElementById("messages").childNodes.length !== 0)
                    lastOwner = document.getElementById("messages").lastChild.firstChild.firstChild;

                let container = document.createElement("div");
                let header = document.createElement("div");
                let bubble = document.createElement("div");
                let owner = document.createElement("li");
                let message = document.createElement("li");
                let date = document.createElement("label");
                container.className = "container";
                bubble.className = "bubble";

                owner.id = msg.id;
                owner.innerHTML = msg.owner;
                message.innerHTML = msg.value;
                date.innerHTML = " - (" + days[realDate.getDay()] + " at " + realDate.getHours() + ':' + (realDate.getMinutes() < 10 ? '0' : '') + realDate.getMinutes() + ')';


                header.appendChild(owner);
                header.appendChild(date);
                container.appendChild(header);
                if (id === msg.id && document.getElementById("username").value === msg.owner) {
                    bubble.style.justifyContent = "flex-end";
                    header.className = "header";
                    message.className = "message myself";
                } else {
                    header.className = "header other";
                    message.className = "message other";
                }
                if (lastOwner.id === msg.id && lastOwner.innerHTML === msg.owner) {
                    header.className = "header";
                    document.getElementById("messages").lastChild.style.marginBottom = "5px";
                }
                bubble.appendChild(message);
                container.append(bubble);

                document.getElementById("messages").appendChild(container);
                document.getElementById("messages").scrollTop = container.offsetHeight + container.offsetTop;
            });
        </script>
    </body>
</html>