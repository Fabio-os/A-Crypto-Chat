<!doctype html>
<html>
    <head>
        <title>A-Crypto-Chat</title>
        <style>
            :root {
                --main-color: #272346;
                --dark-color: #0c002b;
                --bubble-color: #5300a1;
                --light-color: #ddd;
            }
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font: 13px Helvetica, Arial;
            }
            form {
                background: linear-gradient(180deg, var(--main-color) 0%, var(--dark-color) 100%);
                padding: 3px;
                position: fixed;
                bottom: 0;
                width: 100%;
                height: 100%;
            }
            form input {
                background: var(--main-color);
                border: 0;
                border-radius: 50px;
                outline: none;
                padding: 20px;
                width: calc(100% - 140px);
                height: 40px;
                margin-right: .5%;
                color: white;
                margin-left: 10px;
            }
            form button {
                user-select: none;
                text-transform: uppercase;
                width: 100px;
                height: 40px;
                color: var(--dark-color);
                font-size: 16px;
                outline: none;
                border-radius: 30px;
                border: none;
                background: var(--light-color);
                transition: all 0.5s ease;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                animation: fade-in 2s ease forwards;
                float: rigth;
                margin-left: 20px;
            }
            form button:hover {
                color: var(--dark-color);
                background: var(--light-color);
                box-shadow: 0 0px 50px rgba(255, 255, 255, 0.3);
            }
            #messages {
                list-style-type: none;
                margin: 0;
                padding: 0;
                height: calc(100% - 160px);
                overflow-y: scroll;
                margin-top: 20px;
                margin-bottom: 20px;
            }
            #username {
                width: 250px;
                margin-bottom: 20px;
                margin-top: 10px;
                background: var(--dark-color);
            }
            .scroll::-webkit-scrollbar {
                width: 10px;
            }
            .scroll::-webkit-scrollbar-thumb {
                background: white;
                border-radius:
                20px;
            }
            .scroll::-webkit-scrollbar-track {
                background: var(--bubble-color);
                border-radius: 10px;
            }
        </style>
    </head>
    <body>
        <form id="form" action="">
            <input id="username" maxlength="15" placeholder="Username" value="Unnamed" required/>
            <div class="separator"></div>
            <ul id="messages" class="scroll"></ul>
            <input id="message" autocomplete="off" placeholder="message" required/><button>Send</button>
        </form>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
        <script>
            const socket = io();
            async function onFormSubmit(event) {
                event.preventDefault();
                let message = {};
                message.owner = document.getElementById("username").value;
                message.value = document.getElementById("message").value;
                socket.emit("chat message", message);
                document.getElementById("message").value = "";
                return false;
            }
            document.getElementById("form").addEventListener("submit", onFormSubmit);
            socket.on("chat message", (msg) => {
                let lastOwner = "";
                const days = {
                    1: "Monday",
                    2: "Tuesday",
                    3: "Wednesday",
                    4: "Thursday",
                    5: "Friday",
                    6: "Saturday",
                    7: "Synday"
                };
                const realDate = new Date();
                if (document.getElementById("messages").childNodes.length !== 0)
                    lastOwner = document.getElementById("messages").lastChild.previousElementSibling.previousElementSibling.innerHTML;

                let owner = document.createElement("li");
                let message = document.createElement("li");
                let date = document.createElement("label");

                owner.innerHTML = msg.owner;
                message.innerHTML = msg.value;
                date.innerHTML = days[realDate.getDay()] + " at " + realDate.getHours() + ':' + (realDate.getMinutes() < 10 ? '0' : '') + realDate.getMinutes();

                owner.style.color = "grey";
                owner.style.fontStyle = "italic";
                owner.style.fontSize = "12px";
                owner.style.marginBottom = "5px";
                owner.style.marginLeft = "15px";
                if (lastOwner === msg.owner) {
                    owner.style.fontSize = "0px";
                    document.getElementById("messages").lastChild.previousElementSibling.style.marginBottom = "5px";
                }

                message.style.padding = "10px 15px";
                message.style.background = "var(--bubble-color)";
                message.style.color = "white";
                message.style.marginBottom = "20px";
                message.style.marginLeft = "10px";
                message.style.display = "inline-block";
                message.style.borderRadius = "20px";
                message.style.maxWidth = "75%";

                date.style.color = "white";
                date.style.marginLeft = "15px";

                document.getElementById("messages").appendChild(owner);
                document.getElementById("messages").appendChild(message);
                document.getElementById("messages").appendChild(date);
                document.getElementById("messages").scrollTop = owner.offsetHeight + owner.offsetTop + message.offsetHeight + message.offsetTop;
            });
        </script>
    </body>
</html>